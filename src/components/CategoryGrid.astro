---
import { getLangFromUrl, useTranslations } from '@i18n/utils';

// ä½¿ç”¨import.meta.globé™æ€å¯¼å…¥æ‰€æœ‰è¯­è¨€çš„å·¥å…·æ–‡ä»¶
const enToolsModules = import.meta.glob('@content/tools/en/*.md', { eager: true });
const esToolsModules = import.meta.glob('@content/tools/es/*.md', { eager: true });
const frToolsModules = import.meta.glob('@content/tools/fr/*.md', { eager: true });
const zhToolsModules = import.meta.glob('@content/tools/zh/*.md', { eager: true });

// å°†æ¨¡å—è½¬æ¢ä¸ºå·¥å…·æ•°ç»„
const enTools = Object.values(enToolsModules);
const esTools = Object.values(esToolsModules);
const frTools = Object.values(frToolsModules);
const zhTools = Object.values(zhToolsModules);

// åˆ›å»ºè¯­è¨€åˆ°å·¥å…·æ•°ç»„çš„æ˜ å°„
const langToolsMap = {
  en: enTools,
  es: esTools,
  fr: frTools,
  zh: zhTools
};

// è·å–å½“å‰è¯­è¨€
const lang = getLangFromUrl(Astro.url);

// è·å–å½“å‰è¯­è¨€çš„å·¥å…·æ–‡ä»¶
let toolFiles = langToolsMap[lang] || enTools;

// è®¡ç®—æ¯ä¸ªåˆ†ç±»çš„å·¥å…·æ•°é‡
const categoryCounts: Record<string, number> = {};
toolFiles.forEach((tool: any) => {
  const category = tool.frontmatter.category;
  categoryCounts[category] = (categoryCounts[category] || 0) + 1;
});

const categories = [
  { id: 'text-generation', name: 'categories.text-generation', icon: 'ğŸ“', count: categoryCounts['text-generation'] || 0 },
  { id: 'image-generation', name: 'categories.image-generation', icon: 'ğŸ¨', count: categoryCounts['image-generation'] || 0 },
  { id: 'code-generation', name: 'categories.code-generation', icon: 'ğŸ’»', count: categoryCounts['code-generation'] || 0 },
  { id: 'audio-generation', name: 'categories.audio-generation', icon: 'ğŸµ', count: categoryCounts['audio-generation'] || 0 },
  { id: 'video-generation', name: 'categories.video-generation', icon: 'ğŸ¥', count: categoryCounts['video-generation'] || 0 },
  { id: 'chatbots', name: 'categories.chatbots', icon: 'ğŸ’¬', count: categoryCounts['chatbots'] || 0 },
  { id: 'data-analysis', name: 'categories.data-analysis', icon: 'ğŸ“Š', count: categoryCounts['data-analysis'] || 0 },
  { id: 'automation', name: 'categories.automation', icon: 'âš™ï¸', count: categoryCounts['automation'] || 0 }
];

const t = useTranslations(lang);
---

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
  {categories.map(category => (
    <a
      href={lang === 'en' ? `/categories/${category.id}` : `/${lang}/categories/${category.id}`}
      class="bg-dark-800 p-6 rounded-lg border border-dark-700 hover:border-dark-600 transition-colors duration-200"
    >
      <div class="text-4xl mb-3">{category.icon}</div>
      <h3 class="text-xl font-semibold mb-2 text-dark-50">{t(category.name as keyof typeof import('@i18n/ui').ui.en)}</h3>
      <p class="text-dark-300">{category.count} tools</p>
    </a>
  ))}
</div>